;; gorilla-repl.fileformat = 1

;; **
;;; # Blackbox Variational Inference
;;; 
;;; This worksheet illustrates how to invoke the black-box variational inference of Anglican.
;; **

;; @@
(use 'nstools.ns)
(ns+ bbvi
  (:like anglican-user.worksheet))
;; @@
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[nil,nil]"}
;; <=

;; **
;;; We start with a very simple model. 
;; **

;; @@
(defquery gaussian []
  (let [m      (sample :m (normal 0 5))]
    (observe (normal m 1.) 5.2)
    (observe (normal m 1.) 6.2)
    (observe (normal m 1.) 4.3)
    m))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/gaussian</span>","value":"#'bbvi/gaussian"}
;; <=

;; **
;;; We perform posterior inference using lmh.
;; **

;; @@
(def lmh-samples
  (map :result (take 10000 (take-nth 50 (drop 10000 (doquery :lmh gaussian []))))))

(defn compute-mean [l]
  (let [len (count l)]
    (/ (reduce + 0.0 l) len)))

(def est-mean
  (compute-mean lmh-samples))

(def est-var
  (compute-mean (map #(pow (- % est-mean) 2) lmh-samples)))

(def est-sd
  (sqrt est-var))

(println "estimated mean(lmh): " est-mean)

(println "estimated sd(lmh): " est-sd)
;; @@
;; ->
;;; estimated mean(lmh):  5.16710008008729
;;; estimated sd(lmh):  0.5789288354961913
;;; 
;; <-
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/lmh-samples</span>","value":"#'bbvi/lmh-samples"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/compute-mean</span>","value":"#'bbvi/compute-mean"}],"value":"[#'bbvi/lmh-samples,#'bbvi/compute-mean]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/est-mean</span>","value":"#'bbvi/est-mean"}],"value":"[[#'bbvi/lmh-samples,#'bbvi/compute-mean],#'bbvi/est-mean]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/est-var</span>","value":"#'bbvi/est-var"}],"value":"[[[#'bbvi/lmh-samples,#'bbvi/compute-mean],#'bbvi/est-mean],#'bbvi/est-var]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/est-sd</span>","value":"#'bbvi/est-sd"}],"value":"[[[[#'bbvi/lmh-samples,#'bbvi/compute-mean],#'bbvi/est-mean],#'bbvi/est-var],#'bbvi/est-sd]"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[[[[[#'bbvi/lmh-samples,#'bbvi/compute-mean],#'bbvi/est-mean],#'bbvi/est-var],#'bbvi/est-sd],nil]"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[[[[[[#'bbvi/lmh-samples,#'bbvi/compute-mean],#'bbvi/est-mean],#'bbvi/est-var],#'bbvi/est-sd],nil],nil]"}
;; <=

;; **
;;; We now perform inference using black-box variational inference
;; **

;; @@
(def num-of-iterations 
  50000)

(def bbvi-result 
  (nth (doquery :bbvb gaussian []) num-of-iterations))  
  
(clojure.pprint/pprint
  (anglican.bbvb/get-variational bbvi-result))
;; @@
;; ->
;;; {:m
;;;  {(0 anglican.runtime.normal-distribution)
;;;   {:mean 5.164473709066925,
;;;    :sd 0.5735430628446258,
;;;    :dist23175
;;;    #object[org.apache.commons.math3.distribution.NormalDistribution 0x435201b &quot;org.apache.commons.math3.distribution.NormalDistribution@435201b&quot;]}}}
;;; 
;; <-
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/num-of-iterations</span>","value":"#'bbvi/num-of-iterations"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/bbvi-result</span>","value":"#'bbvi/bbvi-result"}],"value":"[#'bbvi/num-of-iterations,#'bbvi/bbvi-result]"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[[#'bbvi/num-of-iterations,#'bbvi/bbvi-result],nil]"}
;; <=

;; **
;;; Our next example is slightly more complex. We consider a mixture of two Gaussians.
;; **

;; @@
(defquery mixture []
  (let [p  (sample :p (beta 1 1))
        m1 (sample :m1 (normal 0 5))
        m2 (sample :m2 (normal 0 5))
        f  (fn [y] 
             (if (sample (flip p))
               (observe (normal m1 1.) y)
               (observe (normal m2 1.) y)))]
    (map f (list 0.8 1.2 7.8 2.4 8.2 
                 10.7 5.3 2.6 1.2 3.4 5.6))
    [p m1 m2]))

(def data-mixture 
  (list 0.8 1.2 7.8 2.4 8.2 
        10.7 5.3 2.6 1.2 3.4 5.6))

(plot/histogram data-mixture :bins 5)
;; @@
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/mixture</span>","value":"#'bbvi/mixture"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/data-mixture</span>","value":"#'bbvi/data-mixture"}],"value":"[#'bbvi/mixture,#'bbvi/data-mixture]"},{"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c","values":[{"x":0.8,"y":0},{"x":2.7800000000000002,"y":5},{"x":4.76,"y":1},{"x":6.74,"y":2},{"x":8.72,"y":2},{"x":10.700000000000001,"y":1},{"x":12.680000000000001,"y":0}]}],"marks":[{"type":"line","from":{"data":"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c\", :values ({:x 0.8, :y 0} {:x 2.7800000000000002, :y 5.0} {:x 4.76, :y 1.0} {:x 6.74, :y 2.0} {:x 8.72, :y 2.0} {:x 10.700000000000001, :y 1.0} {:x 12.680000000000001, :y 0})}], :marks [{:type \"line\", :from {:data \"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}],"value":"[[#'bbvi/mixture,#'bbvi/data-mixture],#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c\", :values ({:x 0.8, :y 0} {:x 2.7800000000000002, :y 5.0} {:x 4.76, :y 1.0} {:x 6.74, :y 2.0} {:x 8.72, :y 2.0} {:x 10.700000000000001, :y 1.0} {:x 12.680000000000001, :y 0})}], :marks [{:type \"line\", :from {:data \"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"e74fe8a2-b93d-4e48-8a0e-4799a4b7657c\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}]"}
;; <=

;; **
;;; We next perform inference using lmh.
;; **

;; @@
(def lmh-samples
  (map :result (take 20000 (take-nth 5 (drop 10000 (doquery :lmh mixture []))))))

(def p-samples
  (map first lmh-samples))

(def m1-samples
  (map second lmh-samples))

(def m2-samples
  (map #(nth % 2) lmh-samples))

(def est-p-mean (compute-mean p-samples))
(def est-m1-mean (compute-mean m1-samples))
(def est-m2-mean (compute-mean m2-samples))

(defn compute-sd [samples]
  (let [m        (compute-mean samples)
        variance (compute-mean (map #(pow (- % m) 2) samples))
        sd       (sqrt variance)]
    sd))

(def est-p-sd (compute-sd p-samples))
(def est-m1-sd (compute-sd m1-samples))
(def est-m2-sd (compute-sd m2-samples))

(println "estimated p-mean(lmh): " est-p-mean)
(println "estimated p-sd(lmh): " est-p-sd)
(println "estimated m1-mean(lmh): " est-m1-mean)
(println "estimated m1-sd(lmh): " est-m1-sd)
(println "estimated m2-mean(lmh): " est-m2-mean)
(println "estimated m2-sd(lmh): " est-m2-sd)
;; @@
;; ->
;;; estimated p-mean(lmh):  0.5782189211745785
;;; estimated p-sd(lmh):  0.14633094200155755
;;; estimated m1-mean(lmh):  2.1745474394730184
;;; estimated m1-sd(lmh):  0.532685375921339
;;; estimated m2-mean(lmh):  7.843663286260157
;;; estimated m2-sd(lmh):  0.6744817137932311
;;; 
;; <-
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/lmh-samples</span>","value":"#'bbvi/lmh-samples"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/p-samples</span>","value":"#'bbvi/p-samples"}],"value":"[#'bbvi/lmh-samples,#'bbvi/p-samples]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/m1-samples</span>","value":"#'bbvi/m1-samples"}],"value":"[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/m2-samples</span>","value":"#'bbvi/m2-samples"}],"value":"[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/est-p-mean</span>","value":"#'bbvi/est-p-mean"}],"value":"[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/est-m1-mean</span>","value":"#'bbvi/est-m1-mean"}],"value":"[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/est-m2-mean</span>","value":"#'bbvi/est-m2-mean"}],"value":"[[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean],#'bbvi/est-m2-mean]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/compute-sd</span>","value":"#'bbvi/compute-sd"}],"value":"[[[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean],#'bbvi/est-m2-mean],#'bbvi/compute-sd]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/est-p-sd</span>","value":"#'bbvi/est-p-sd"}],"value":"[[[[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean],#'bbvi/est-m2-mean],#'bbvi/compute-sd],#'bbvi/est-p-sd]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/est-m1-sd</span>","value":"#'bbvi/est-m1-sd"}],"value":"[[[[[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean],#'bbvi/est-m2-mean],#'bbvi/compute-sd],#'bbvi/est-p-sd],#'bbvi/est-m1-sd]"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/est-m2-sd</span>","value":"#'bbvi/est-m2-sd"}],"value":"[[[[[[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean],#'bbvi/est-m2-mean],#'bbvi/compute-sd],#'bbvi/est-p-sd],#'bbvi/est-m1-sd],#'bbvi/est-m2-sd]"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[[[[[[[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean],#'bbvi/est-m2-mean],#'bbvi/compute-sd],#'bbvi/est-p-sd],#'bbvi/est-m1-sd],#'bbvi/est-m2-sd],nil]"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[[[[[[[[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean],#'bbvi/est-m2-mean],#'bbvi/compute-sd],#'bbvi/est-p-sd],#'bbvi/est-m1-sd],#'bbvi/est-m2-sd],nil],nil]"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[[[[[[[[[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean],#'bbvi/est-m2-mean],#'bbvi/compute-sd],#'bbvi/est-p-sd],#'bbvi/est-m1-sd],#'bbvi/est-m2-sd],nil],nil],nil]"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[[[[[[[[[[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean],#'bbvi/est-m2-mean],#'bbvi/compute-sd],#'bbvi/est-p-sd],#'bbvi/est-m1-sd],#'bbvi/est-m2-sd],nil],nil],nil],nil]"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[[[[[[[[[[[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean],#'bbvi/est-m2-mean],#'bbvi/compute-sd],#'bbvi/est-p-sd],#'bbvi/est-m1-sd],#'bbvi/est-m2-sd],nil],nil],nil],nil],nil]"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[[[[[[[[[[[[[[[[#'bbvi/lmh-samples,#'bbvi/p-samples],#'bbvi/m1-samples],#'bbvi/m2-samples],#'bbvi/est-p-mean],#'bbvi/est-m1-mean],#'bbvi/est-m2-mean],#'bbvi/compute-sd],#'bbvi/est-p-sd],#'bbvi/est-m1-sd],#'bbvi/est-m2-sd],nil],nil],nil],nil],nil],nil]"}
;; <=

;; **
;;; We visualize the results.
;; **

;; @@
(plot/histogram p-samples :bins 40 :normalize :probability)
(plot/histogram m1-samples :bins 40 :normalize :probability)
(plot/histogram m2-samples :bins 40 :normalize :probability)
;; @@
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54","values":[{"x":0.10132932918744376,"y":0},{"x":0.12304201061428711,"y":0.0005},{"x":0.14475469204113045,"y":0.00015},{"x":0.1664673734679738,"y":0.0015},{"x":0.18818005489481715,"y":0.00185},{"x":0.2098927363216605,"y":0.0016},{"x":0.23160541774850385,"y":0.002},{"x":0.2533180991753472,"y":0.0038},{"x":0.27503078060219055,"y":0.0094},{"x":0.2967434620290339,"y":0.00715},{"x":0.31845614345587725,"y":0.0097},{"x":0.3401688248827206,"y":0.01645},{"x":0.36188150630956395,"y":0.01765},{"x":0.3835941877364073,"y":0.0276},{"x":0.40530686916325065,"y":0.0193},{"x":0.427019550590094,"y":0.03335},{"x":0.44873223201693735,"y":0.0366},{"x":0.4704449134437807,"y":0.0497},{"x":0.49215759487062405,"y":0.0495},{"x":0.5138702762974674,"y":0.0488},{"x":0.5355829577243107,"y":0.0674},{"x":0.5572956391511541,"y":0.04435},{"x":0.5790083205779974,"y":0.0644},{"x":0.6007210020048408,"y":0.0453},{"x":0.6224336834316841,"y":0.04715},{"x":0.6441463648585275,"y":0.04785},{"x":0.6658590462853708,"y":0.0487},{"x":0.6875717277122142,"y":0.05065},{"x":0.7092844091390575,"y":0.05045},{"x":0.7309970905659009,"y":0.03895},{"x":0.7527097719927442,"y":0.03725},{"x":0.7744224534195876,"y":0.02955},{"x":0.796135134846431,"y":0.02105},{"x":0.8178478162732743,"y":0.01865},{"x":0.8395604977001176,"y":0.0166},{"x":0.861273179126961,"y":0.01325},{"x":0.8829858605538043,"y":0.00815},{"x":0.9046985419806477,"y":0.01075},{"x":0.926411223407491,"y":0.00185},{"x":0.9481239048343344,"y":0.0008},{"x":0.9698365862611777,"y":0.0003},{"x":0.9915492676880211,"y":0}]}],"marks":[{"type":"line","from":{"data":"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\", :values ({:x 0.10132932918744376, :y 0} {:x 0.12304201061428711, :y 5.0E-4} {:x 0.14475469204113045, :y 1.5E-4} {:x 0.1664673734679738, :y 0.0015} {:x 0.18818005489481715, :y 0.00185} {:x 0.2098927363216605, :y 0.0016} {:x 0.23160541774850385, :y 0.002} {:x 0.2533180991753472, :y 0.0038} {:x 0.27503078060219055, :y 0.0094} {:x 0.2967434620290339, :y 0.00715} {:x 0.31845614345587725, :y 0.0097} {:x 0.3401688248827206, :y 0.01645} {:x 0.36188150630956395, :y 0.01765} {:x 0.3835941877364073, :y 0.0276} {:x 0.40530686916325065, :y 0.0193} {:x 0.427019550590094, :y 0.03335} {:x 0.44873223201693735, :y 0.0366} {:x 0.4704449134437807, :y 0.0497} {:x 0.49215759487062405, :y 0.0495} {:x 0.5138702762974674, :y 0.0488} {:x 0.5355829577243107, :y 0.0674} {:x 0.5572956391511541, :y 0.04435} {:x 0.5790083205779974, :y 0.0644} {:x 0.6007210020048408, :y 0.0453} {:x 0.6224336834316841, :y 0.04715} {:x 0.6441463648585275, :y 0.04785} {:x 0.6658590462853708, :y 0.0487} {:x 0.6875717277122142, :y 0.05065} {:x 0.7092844091390575, :y 0.05045} {:x 0.7309970905659009, :y 0.03895} {:x 0.7527097719927442, :y 0.03725} {:x 0.7744224534195876, :y 0.02955} {:x 0.796135134846431, :y 0.02105} {:x 0.8178478162732743, :y 0.01865} {:x 0.8395604977001176, :y 0.0166} {:x 0.861273179126961, :y 0.01325} {:x 0.8829858605538043, :y 0.00815} {:x 0.9046985419806477, :y 0.01075} {:x 0.926411223407491, :y 0.00185} {:x 0.9481239048343344, :y 8.0E-4} {:x 0.9698365862611777, :y 3.0E-4} {:x 0.9915492676880211, :y 0})}], :marks [{:type \"line\", :from {:data \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"},{"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"2d307c81-0052-4756-b44a-63c68ea1199d","values":[{"x":0.8099575889814934,"y":0},{"x":0.88333950789086,"y":0.0006},{"x":0.9567214268002266,"y":0.0057},{"x":1.0301033457095932,"y":0.0019},{"x":1.1034852646189597,"y":0.00085},{"x":1.1768671835283262,"y":0.01465},{"x":1.2502491024376927,"y":0.00995},{"x":1.3236310213470592,"y":0.01735},{"x":1.3970129402564258,"y":0.02325},{"x":1.4703948591657923,"y":0.03005},{"x":1.5437767780751588,"y":0.01935},{"x":1.6171586969845253,"y":0.0269},{"x":1.6905406158938918,"y":0.04165},{"x":1.7639225348032583,"y":0.04015},{"x":1.8373044537126249,"y":0.0413},{"x":1.9106863726219914,"y":0.0473},{"x":1.9840682915313579,"y":0.04185},{"x":2.0574502104407246,"y":0.0541},{"x":2.1308321293500914,"y":0.0701},{"x":2.204214048259458,"y":0.0392},{"x":2.277595967168825,"y":0.04955},{"x":2.3509778860781916,"y":0.06735},{"x":2.4243598049875583,"y":0.05515},{"x":2.497741723896925,"y":0.0449},{"x":2.571123642806292,"y":0.03545},{"x":2.6445055617156585,"y":0.03085},{"x":2.7178874806250253,"y":0.03265},{"x":2.791269399534392,"y":0.01755},{"x":2.8646513184437588,"y":0.0278},{"x":2.9380332373531255,"y":0.02115},{"x":3.0114151562624922,"y":0.0105},{"x":3.084797075171859,"y":0.0225},{"x":3.1581789940812257,"y":0.0191},{"x":3.2315609129905924,"y":0.0126},{"x":3.304942831899959,"y":0.01045},{"x":3.378324750809326,"y":0.0042},{"x":3.4517066697186927,"y":0.00175},{"x":3.5250885886280594,"y":0.0063},{"x":3.598470507537426,"y":0.0021},{"x":3.671852426446793,"y":0.00085},{"x":3.7452343453561596,"y":0.00105},{"x":3.8186162642655264,"y":0}]}],"marks":[{"type":"line","from":{"data":"2d307c81-0052-4756-b44a-63c68ea1199d"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"2d307c81-0052-4756-b44a-63c68ea1199d","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"2d307c81-0052-4756-b44a-63c68ea1199d","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"2d307c81-0052-4756-b44a-63c68ea1199d\", :values ({:x 0.8099575889814934, :y 0} {:x 0.88333950789086, :y 6.0E-4} {:x 0.9567214268002266, :y 0.0057} {:x 1.0301033457095932, :y 0.0019} {:x 1.1034852646189597, :y 8.5E-4} {:x 1.1768671835283262, :y 0.01465} {:x 1.2502491024376927, :y 0.00995} {:x 1.3236310213470592, :y 0.01735} {:x 1.3970129402564258, :y 0.02325} {:x 1.4703948591657923, :y 0.03005} {:x 1.5437767780751588, :y 0.01935} {:x 1.6171586969845253, :y 0.0269} {:x 1.6905406158938918, :y 0.04165} {:x 1.7639225348032583, :y 0.04015} {:x 1.8373044537126249, :y 0.0413} {:x 1.9106863726219914, :y 0.0473} {:x 1.9840682915313579, :y 0.04185} {:x 2.0574502104407246, :y 0.0541} {:x 2.1308321293500914, :y 0.0701} {:x 2.204214048259458, :y 0.0392} {:x 2.277595967168825, :y 0.04955} {:x 2.3509778860781916, :y 0.06735} {:x 2.4243598049875583, :y 0.05515} {:x 2.497741723896925, :y 0.0449} {:x 2.571123642806292, :y 0.03545} {:x 2.6445055617156585, :y 0.03085} {:x 2.7178874806250253, :y 0.03265} {:x 2.791269399534392, :y 0.01755} {:x 2.8646513184437588, :y 0.0278} {:x 2.9380332373531255, :y 0.02115} {:x 3.0114151562624922, :y 0.0105} {:x 3.084797075171859, :y 0.0225} {:x 3.1581789940812257, :y 0.0191} {:x 3.2315609129905924, :y 0.0126} {:x 3.304942831899959, :y 0.01045} {:x 3.378324750809326, :y 0.0042} {:x 3.4517066697186927, :y 0.00175} {:x 3.5250885886280594, :y 0.0063} {:x 3.598470507537426, :y 0.0021} {:x 3.671852426446793, :y 8.5E-4} {:x 3.7452343453561596, :y 0.00105} {:x 3.8186162642655264, :y 0})}], :marks [{:type \"line\", :from {:data \"2d307c81-0052-4756-b44a-63c68ea1199d\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"2d307c81-0052-4756-b44a-63c68ea1199d\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"2d307c81-0052-4756-b44a-63c68ea1199d\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}],"value":"[#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\", :values ({:x 0.10132932918744376, :y 0} {:x 0.12304201061428711, :y 5.0E-4} {:x 0.14475469204113045, :y 1.5E-4} {:x 0.1664673734679738, :y 0.0015} {:x 0.18818005489481715, :y 0.00185} {:x 0.2098927363216605, :y 0.0016} {:x 0.23160541774850385, :y 0.002} {:x 0.2533180991753472, :y 0.0038} {:x 0.27503078060219055, :y 0.0094} {:x 0.2967434620290339, :y 0.00715} {:x 0.31845614345587725, :y 0.0097} {:x 0.3401688248827206, :y 0.01645} {:x 0.36188150630956395, :y 0.01765} {:x 0.3835941877364073, :y 0.0276} {:x 0.40530686916325065, :y 0.0193} {:x 0.427019550590094, :y 0.03335} {:x 0.44873223201693735, :y 0.0366} {:x 0.4704449134437807, :y 0.0497} {:x 0.49215759487062405, :y 0.0495} {:x 0.5138702762974674, :y 0.0488} {:x 0.5355829577243107, :y 0.0674} {:x 0.5572956391511541, :y 0.04435} {:x 0.5790083205779974, :y 0.0644} {:x 0.6007210020048408, :y 0.0453} {:x 0.6224336834316841, :y 0.04715} {:x 0.6441463648585275, :y 0.04785} {:x 0.6658590462853708, :y 0.0487} {:x 0.6875717277122142, :y 0.05065} {:x 0.7092844091390575, :y 0.05045} {:x 0.7309970905659009, :y 0.03895} {:x 0.7527097719927442, :y 0.03725} {:x 0.7744224534195876, :y 0.02955} {:x 0.796135134846431, :y 0.02105} {:x 0.8178478162732743, :y 0.01865} {:x 0.8395604977001176, :y 0.0166} {:x 0.861273179126961, :y 0.01325} {:x 0.8829858605538043, :y 0.00815} {:x 0.9046985419806477, :y 0.01075} {:x 0.926411223407491, :y 0.00185} {:x 0.9481239048343344, :y 8.0E-4} {:x 0.9698365862611777, :y 3.0E-4} {:x 0.9915492676880211, :y 0})}], :marks [{:type \"line\", :from {:data \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}},#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"2d307c81-0052-4756-b44a-63c68ea1199d\", :values ({:x 0.8099575889814934, :y 0} {:x 0.88333950789086, :y 6.0E-4} {:x 0.9567214268002266, :y 0.0057} {:x 1.0301033457095932, :y 0.0019} {:x 1.1034852646189597, :y 8.5E-4} {:x 1.1768671835283262, :y 0.01465} {:x 1.2502491024376927, :y 0.00995} {:x 1.3236310213470592, :y 0.01735} {:x 1.3970129402564258, :y 0.02325} {:x 1.4703948591657923, :y 0.03005} {:x 1.5437767780751588, :y 0.01935} {:x 1.6171586969845253, :y 0.0269} {:x 1.6905406158938918, :y 0.04165} {:x 1.7639225348032583, :y 0.04015} {:x 1.8373044537126249, :y 0.0413} {:x 1.9106863726219914, :y 0.0473} {:x 1.9840682915313579, :y 0.04185} {:x 2.0574502104407246, :y 0.0541} {:x 2.1308321293500914, :y 0.0701} {:x 2.204214048259458, :y 0.0392} {:x 2.277595967168825, :y 0.04955} {:x 2.3509778860781916, :y 0.06735} {:x 2.4243598049875583, :y 0.05515} {:x 2.497741723896925, :y 0.0449} {:x 2.571123642806292, :y 0.03545} {:x 2.6445055617156585, :y 0.03085} {:x 2.7178874806250253, :y 0.03265} {:x 2.791269399534392, :y 0.01755} {:x 2.8646513184437588, :y 0.0278} {:x 2.9380332373531255, :y 0.02115} {:x 3.0114151562624922, :y 0.0105} {:x 3.084797075171859, :y 0.0225} {:x 3.1581789940812257, :y 0.0191} {:x 3.2315609129905924, :y 0.0126} {:x 3.304942831899959, :y 0.01045} {:x 3.378324750809326, :y 0.0042} {:x 3.4517066697186927, :y 0.00175} {:x 3.5250885886280594, :y 0.0063} {:x 3.598470507537426, :y 0.0021} {:x 3.671852426446793, :y 8.5E-4} {:x 3.7452343453561596, :y 0.00105} {:x 3.8186162642655264, :y 0})}], :marks [{:type \"line\", :from {:data \"2d307c81-0052-4756-b44a-63c68ea1199d\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"2d307c81-0052-4756-b44a-63c68ea1199d\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"2d307c81-0052-4756-b44a-63c68ea1199d\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}]"},{"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3","values":[{"x":6.358263613863127,"y":0},{"x":6.455048091142709,"y":0.0036},{"x":6.551832568422291,"y":0.0023},{"x":6.648617045701872,"y":0.00535},{"x":6.745401522981454,"y":0.00725},{"x":6.8421860002610355,"y":0.02585},{"x":6.938970477540617,"y":0.00685},{"x":7.035754954820199,"y":0.02535},{"x":7.13253943209978,"y":0.063},{"x":7.229323909379362,"y":0.05205},{"x":7.326108386658944,"y":0.04825},{"x":7.422892863938525,"y":0.061},{"x":7.519677341218107,"y":0.04975},{"x":7.616461818497688,"y":0.0418},{"x":7.71324629577727,"y":0.0687},{"x":7.810030773056852,"y":0.0623},{"x":7.906815250336433,"y":0.07565},{"x":8.003599727616015,"y":0.0509},{"x":8.100384204895596,"y":0.0463},{"x":8.197168682175176,"y":0.0341},{"x":8.293953159454757,"y":0.01415},{"x":8.390737636734338,"y":0.05145},{"x":8.487522114013919,"y":0.0269},{"x":8.5843065912935,"y":0.01895},{"x":8.68109106857308,"y":0.0282},{"x":8.77787554585266,"y":0.02575},{"x":8.874660023132241,"y":0.03905},{"x":8.971444500411822,"y":0.00815},{"x":9.068228977691403,"y":0.00285},{"x":9.165013454970984,"y":0.01545},{"x":9.261797932250564,"y":0.00865},{"x":9.358582409530145,"y":0.00645},{"x":9.455366886809726,"y":0.00095},{"x":9.552151364089307,"y":0.0008},{"x":9.648935841368887,"y":0},{"x":9.745720318648468,"y":0.00735},{"x":9.842504795928049,"y":0.0099},{"x":9.93928927320763,"y":0},{"x":10.03607375048721,"y":0},{"x":10.132858227766791,"y":0.00135},{"x":10.229642705046372,"y":0},{"x":10.326427182325952,"y":0.0033},{"x":10.423211659605533,"y":0}]}],"marks":[{"type":"line","from":{"data":"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3\", :values ({:x 6.358263613863127, :y 0} {:x 6.455048091142709, :y 0.0036} {:x 6.551832568422291, :y 0.0023} {:x 6.648617045701872, :y 0.00535} {:x 6.745401522981454, :y 0.00725} {:x 6.8421860002610355, :y 0.02585} {:x 6.938970477540617, :y 0.00685} {:x 7.035754954820199, :y 0.02535} {:x 7.13253943209978, :y 0.063} {:x 7.229323909379362, :y 0.05205} {:x 7.326108386658944, :y 0.04825} {:x 7.422892863938525, :y 0.061} {:x 7.519677341218107, :y 0.04975} {:x 7.616461818497688, :y 0.0418} {:x 7.71324629577727, :y 0.0687} {:x 7.810030773056852, :y 0.0623} {:x 7.906815250336433, :y 0.07565} {:x 8.003599727616015, :y 0.0509} {:x 8.100384204895596, :y 0.0463} {:x 8.197168682175176, :y 0.0341} {:x 8.293953159454757, :y 0.01415} {:x 8.390737636734338, :y 0.05145} {:x 8.487522114013919, :y 0.0269} {:x 8.5843065912935, :y 0.01895} {:x 8.68109106857308, :y 0.0282} {:x 8.77787554585266, :y 0.02575} {:x 8.874660023132241, :y 0.03905} {:x 8.971444500411822, :y 0.00815} {:x 9.068228977691403, :y 0.00285} {:x 9.165013454970984, :y 0.01545} {:x 9.261797932250564, :y 0.00865} {:x 9.358582409530145, :y 0.00645} {:x 9.455366886809726, :y 9.5E-4} {:x 9.552151364089307, :y 8.0E-4} {:x 9.648935841368887, :y 0.0} {:x 9.745720318648468, :y 0.00735} {:x 9.842504795928049, :y 0.0099} {:x 9.93928927320763, :y 0.0} {:x 10.03607375048721, :y 0.0} {:x 10.132858227766791, :y 0.00135} {:x 10.229642705046372, :y 0.0} {:x 10.326427182325952, :y 0.0033} {:x 10.423211659605533, :y 0})}], :marks [{:type \"line\", :from {:data \"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}],"value":"[[#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\", :values ({:x 0.10132932918744376, :y 0} {:x 0.12304201061428711, :y 5.0E-4} {:x 0.14475469204113045, :y 1.5E-4} {:x 0.1664673734679738, :y 0.0015} {:x 0.18818005489481715, :y 0.00185} {:x 0.2098927363216605, :y 0.0016} {:x 0.23160541774850385, :y 0.002} {:x 0.2533180991753472, :y 0.0038} {:x 0.27503078060219055, :y 0.0094} {:x 0.2967434620290339, :y 0.00715} {:x 0.31845614345587725, :y 0.0097} {:x 0.3401688248827206, :y 0.01645} {:x 0.36188150630956395, :y 0.01765} {:x 0.3835941877364073, :y 0.0276} {:x 0.40530686916325065, :y 0.0193} {:x 0.427019550590094, :y 0.03335} {:x 0.44873223201693735, :y 0.0366} {:x 0.4704449134437807, :y 0.0497} {:x 0.49215759487062405, :y 0.0495} {:x 0.5138702762974674, :y 0.0488} {:x 0.5355829577243107, :y 0.0674} {:x 0.5572956391511541, :y 0.04435} {:x 0.5790083205779974, :y 0.0644} {:x 0.6007210020048408, :y 0.0453} {:x 0.6224336834316841, :y 0.04715} {:x 0.6441463648585275, :y 0.04785} {:x 0.6658590462853708, :y 0.0487} {:x 0.6875717277122142, :y 0.05065} {:x 0.7092844091390575, :y 0.05045} {:x 0.7309970905659009, :y 0.03895} {:x 0.7527097719927442, :y 0.03725} {:x 0.7744224534195876, :y 0.02955} {:x 0.796135134846431, :y 0.02105} {:x 0.8178478162732743, :y 0.01865} {:x 0.8395604977001176, :y 0.0166} {:x 0.861273179126961, :y 0.01325} {:x 0.8829858605538043, :y 0.00815} {:x 0.9046985419806477, :y 0.01075} {:x 0.926411223407491, :y 0.00185} {:x 0.9481239048343344, :y 8.0E-4} {:x 0.9698365862611777, :y 3.0E-4} {:x 0.9915492676880211, :y 0})}], :marks [{:type \"line\", :from {:data \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"a05c2492-bb14-4d4d-a18d-00ec6a9f1f54\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}},#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"2d307c81-0052-4756-b44a-63c68ea1199d\", :values ({:x 0.8099575889814934, :y 0} {:x 0.88333950789086, :y 6.0E-4} {:x 0.9567214268002266, :y 0.0057} {:x 1.0301033457095932, :y 0.0019} {:x 1.1034852646189597, :y 8.5E-4} {:x 1.1768671835283262, :y 0.01465} {:x 1.2502491024376927, :y 0.00995} {:x 1.3236310213470592, :y 0.01735} {:x 1.3970129402564258, :y 0.02325} {:x 1.4703948591657923, :y 0.03005} {:x 1.5437767780751588, :y 0.01935} {:x 1.6171586969845253, :y 0.0269} {:x 1.6905406158938918, :y 0.04165} {:x 1.7639225348032583, :y 0.04015} {:x 1.8373044537126249, :y 0.0413} {:x 1.9106863726219914, :y 0.0473} {:x 1.9840682915313579, :y 0.04185} {:x 2.0574502104407246, :y 0.0541} {:x 2.1308321293500914, :y 0.0701} {:x 2.204214048259458, :y 0.0392} {:x 2.277595967168825, :y 0.04955} {:x 2.3509778860781916, :y 0.06735} {:x 2.4243598049875583, :y 0.05515} {:x 2.497741723896925, :y 0.0449} {:x 2.571123642806292, :y 0.03545} {:x 2.6445055617156585, :y 0.03085} {:x 2.7178874806250253, :y 0.03265} {:x 2.791269399534392, :y 0.01755} {:x 2.8646513184437588, :y 0.0278} {:x 2.9380332373531255, :y 0.02115} {:x 3.0114151562624922, :y 0.0105} {:x 3.084797075171859, :y 0.0225} {:x 3.1581789940812257, :y 0.0191} {:x 3.2315609129905924, :y 0.0126} {:x 3.304942831899959, :y 0.01045} {:x 3.378324750809326, :y 0.0042} {:x 3.4517066697186927, :y 0.00175} {:x 3.5250885886280594, :y 0.0063} {:x 3.598470507537426, :y 0.0021} {:x 3.671852426446793, :y 8.5E-4} {:x 3.7452343453561596, :y 0.00105} {:x 3.8186162642655264, :y 0})}], :marks [{:type \"line\", :from {:data \"2d307c81-0052-4756-b44a-63c68ea1199d\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"2d307c81-0052-4756-b44a-63c68ea1199d\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"2d307c81-0052-4756-b44a-63c68ea1199d\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}],#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3\", :values ({:x 6.358263613863127, :y 0} {:x 6.455048091142709, :y 0.0036} {:x 6.551832568422291, :y 0.0023} {:x 6.648617045701872, :y 0.00535} {:x 6.745401522981454, :y 0.00725} {:x 6.8421860002610355, :y 0.02585} {:x 6.938970477540617, :y 0.00685} {:x 7.035754954820199, :y 0.02535} {:x 7.13253943209978, :y 0.063} {:x 7.229323909379362, :y 0.05205} {:x 7.326108386658944, :y 0.04825} {:x 7.422892863938525, :y 0.061} {:x 7.519677341218107, :y 0.04975} {:x 7.616461818497688, :y 0.0418} {:x 7.71324629577727, :y 0.0687} {:x 7.810030773056852, :y 0.0623} {:x 7.906815250336433, :y 0.07565} {:x 8.003599727616015, :y 0.0509} {:x 8.100384204895596, :y 0.0463} {:x 8.197168682175176, :y 0.0341} {:x 8.293953159454757, :y 0.01415} {:x 8.390737636734338, :y 0.05145} {:x 8.487522114013919, :y 0.0269} {:x 8.5843065912935, :y 0.01895} {:x 8.68109106857308, :y 0.0282} {:x 8.77787554585266, :y 0.02575} {:x 8.874660023132241, :y 0.03905} {:x 8.971444500411822, :y 0.00815} {:x 9.068228977691403, :y 0.00285} {:x 9.165013454970984, :y 0.01545} {:x 9.261797932250564, :y 0.00865} {:x 9.358582409530145, :y 0.00645} {:x 9.455366886809726, :y 9.5E-4} {:x 9.552151364089307, :y 8.0E-4} {:x 9.648935841368887, :y 0.0} {:x 9.745720318648468, :y 0.00735} {:x 9.842504795928049, :y 0.0099} {:x 9.93928927320763, :y 0.0} {:x 10.03607375048721, :y 0.0} {:x 10.132858227766791, :y 0.00135} {:x 10.229642705046372, :y 0.0} {:x 10.326427182325952, :y 0.0033} {:x 10.423211659605533, :y 0})}], :marks [{:type \"line\", :from {:data \"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"2ff4dd1b-fdeb-4ef3-9455-b9c48f63e4f3\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}]"}
;; <=

;; **
;;; We analyze the model using black-box variational inference.
;; **

;; @@
(def r1 (nth (doquery :bbvb mixture []) 50000))
(def r2 (anglican.bbvb/get-variational r1))

(print (:p r2) "\n\n" (:m1 r2) "\n\n" (:m2 r2))
;; @@
;; ->
;;; {(0 anglican.runtime.beta-distribution) (anglican.runtime/beta 6.765287422267994 5.346760324478156)} 
;;; 
;;;  {(0 anglican.runtime.normal-distribution) (anglican.runtime/normal 2.103819374566423 0.38317375867070796)} 
;;; 
;;;  {(0 anglican.runtime.normal-distribution) (anglican.runtime/normal 7.242181702264095 0.4170153403540341)}
;; <-
;; =>
;;; {"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"list-like","open":"","close":"","separator":"</pre><pre>","items":[{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/r1</span>","value":"#'bbvi/r1"},{"type":"html","content":"<span class='clj-var'>#&#x27;bbvi/r2</span>","value":"#'bbvi/r2"}],"value":"[#'bbvi/r1,#'bbvi/r2]"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[[#'bbvi/r1,#'bbvi/r2],nil]"}
;; <=

;; @@
s
;; @@
